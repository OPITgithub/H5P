<!-- Styles -->
<style>
    #chartdiv {
        width: 100%;
        height: 500px;
        max-width: 100%;
    }
</style>

<!-- Resources -->
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/xy.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

<!-- Chart code -->
<script>
    am5.ready(function () {

        // Create root element
        // https://www.amcharts.com/docs/v5/getting-started/#Root_element
        var root = am5.Root.new("chartdiv");
        root.dateFormatter.setAll({
            dateFormat: "yyyy-MM-dd",
            dateFields: ["valueX", "openValueX"]
        });

        // Set themes
        // https://www.amcharts.com/docs/v5/concepts/themes/
        root.setThemes([
            am5themes_Animated.new(root)
        ]);

        var weekData = {};
        var firstWeek = 1;
        var lastWeek = 13;
        var currentWeek = firstWeek;

        var categories = [

            { category: "Modules" }
        ];

        var startDate = new Date("2024-09-16T00:00:00");
        for (var week = firstWeek; week <= lastWeek; week++) {
            var fromDate = new Date(startDate);
            fromDate.setDate(fromDate.getDate() + (week * 7));
            var toDate = new Date(fromDate);
            toDate.setDate(toDate.getDate() + 6);
            weekData[week] = {
                category: "Modules",
                task: "Week " + (week + 1),
                start: fromDate.getTime(),
                end: toDate.getTime(),
                columnSettings: {
                    fill: am5.color(0xe3853c)
                }
            };

        }

        // Create chart
        // https://www.amcharts.com/docs/v5/charts/xy-chart/
        var chart = root.container.children.push(am5xy.XYChart.new(root, {
            panX: true,
            panY: true,
            wheelY: "zoomXY",
            pinchZoomX: true,
            pinchZoomY: true
        }));

        /*var chart = root.container.children.push(am5xy.XYChart.new(root, {
          panX: false,
          panY: false,
          wheelX: "panX",
          wheelY: "zoomX",
          paddingLeft: 0,
          layout: root.verticalLayout
        }));*/

        // Create axes
        // https://www.amcharts.com/docs/v5/charts/xy-chart/axes/

        /// categories
        var yAxis = chart.yAxes.push(
            am5xy.CategoryAxis.new(root, {
                categoryField: "category",
                renderer: yRenderer,
                tooltip: am5.Tooltip.new(root, {})
            })
        );

        var yRenderer = am5xy.AxisRendererY.new(root, {
            minorGridEnabled: true,
            inversed: true,
        });
        yRenderer.grid.template.set("location", 1);

        yAxis.data.setAll(categories);
        /////////////////////

        var xAxis = chart.xAxes.push(
            am5xy.DateAxis.new(root, {
                baseInterval: { timeUnit: "day", count: 1 },
                renderer: am5xy.AxisRendererX.new(root, {
                    strokeOpacity: 0.1,
                    minorGridEnabled: true,
                    minGridDistance: 80
                })
            })
        );

        var series = chart.series.push(am5xy.ColumnSeries.new(root, {
            xAxis: xAxis,
            yAxis: yAxis,
            openValueXField: "start",
            valueXField: "end",
            categoryYField: "category",
            sequencedInterpolation: true
        }));

        //       series.strokes.template.set("forceHidden", true);


        // color fills
        /* var series0 = chart.series.push(am5xy.LineSeries.new(root, {
             xAxis: xAxis,
             yAxis: yAxis,
             valueXField: "ax",
             valueYField: "ay",
             fill: am5.color(0xe3853c)
         }));
         series0.fills.template.setAll({ fillOpacity: 0.9, visible: true });
         series0.strokes.template.set("forceHidden", true);
         series0.data.setAll([
             { ax: -200, ay: 0 },
             { ax: 0, ay: 0 },
             { ax: 0, ay: 200 },
             { ax: -200, ay: 200 }
         ]);
 */

        series.bullets.push(function (root, series, dataItem) {
            return am5.Bullet.new(root, {
                locationX: 0.5,
                sprite: am5.Label.new(root, {
                    text: dataItem.dataContext.task,
                    fontSize: "8px",
                    fill: am5.color(0xffffff),
                    centerX: am5.p50,
                    centerY: am5.p50,
                    //maxWidth: 120, // Adjust the width as needed
                    wrap: true,
                    truncate: false,
                    oversizedBehavior: "wrap",
                    textAlign: "center"
                })
            });
        });

        series.columns.template.setAll({
            templateField: "columnSettings",
            strokeOpacity: 0,
            tooltipText: "{task}:\n[bold]{openValueX}[/] - [bold]{valueX}[/]"
        });


        // move grid forward
        chart.plotContainer.children.moveValue(
            chart.gridContainer,
            chart.plotContainer.children.length - 1
        );

        // Create series
        // https://www.amcharts.com/docs/v5/charts/xy-chart/series/

        series.data.setAll(weekData);


        // Add cursor
        // https://www.amcharts.com/docs/v5/charts/xy-chart/cursor/
        chart.set("cursor", am5xy.XYCursor.new(root, {
            xAxis: xAxis,
            yAxis: yAxis
        }));

        // Add scrollbars
        // https://www.amcharts.com/docs/v5/charts/xy-chart/scrollbars/
        chart.set("scrollbarX", am5.Scrollbar.new(root, {
            orientation: "horizontal"
        }));

        chart.set("scrollbarY", am5.Scrollbar.new(root, {
            orientation: "vertical"
        }));

        // Label
        var label = chart.plotContainer.children.push(am5.Label.new(root, {
            text: currentWeek.toString(),
            fontSize: "5em",
            fill: am5.color(0x000000),
            opacity: 0.3
        }));

        // Create controls
        var container = chart.plotContainer.children.push(am5.Container.new(root, {
            y: am5.p100,
            centerX: am5.p50,
            centerY: am5.p100,
            x: am5.p50,
            width: am5.percent(90),
            layout: root.horizontalLayout,
            paddingBottom: 10
        }));

        var playButton = container.children.push(am5.Button.new(root, {
            themeTags: ["play"],
            centerY: am5.p50,
            marginRight: 20,
            icon: am5.Graphics.new(root, {
                themeTags: ["icon"]
            })
        }));

        playButton.events.on("click", function () {
            if (playButton.get("active")) {
                slider.set("start", slider.get("start") + 0.0001);
            } else {
                slider.animate({
                    key: "start",
                    to: 1,
                    duration: 15000 * (1 - slider.get("start"))
                });
            }
        });

        var slider = container.children.push(am5.Slider.new(root, {
            orientation: "horizontal",
            start: 0,
            centerY: am5.p50
        }));

        slider.on("start", function (start) {
            if (start === 1) {
                playButton.set("active", false);
            }
        });

        slider.events.on("rangechanged", function () {
            updateSeriesData(
                currentWeek);
        });

        function updateSeriesData(week) {

            var i = 0;
            am5.array.each(weekData, function (item) {
                series.data.setIndex(i, item);
                i++;
            });

            label.set("text", week.toString());
        }

        series.data.setAll(weekData);

        // Make stuff animate on load
        // https://www.amcharts.com/docs/v5/concepts/animations/
        series.appear(1000);
        chart.appear(1000, 100);

    }); // end am5.ready()
</script>

<!-- HTML -->
<div id="chartdiv"></div>